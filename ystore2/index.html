<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Hub - GitHub Pages Ready</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #ffffff;
            color: #202124;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <i class="fa-solid fa-bars text-xl text-gray-600"></i>
            <h1 class="text-xl font-medium text-gray-700">Game Hub</h1>
        </div>
        <div class="flex items-center gap-5 text-gray-600">
            <i class="fa-solid fa-magnifying-glass"></i>
            <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white text-xs">User</div>
        </div>
    </header>

    <!-- Category Tabs -->
    <nav class="bg-white border-b border-gray-200 overflow-x-auto hide-scrollbar">
        <div id="category-tabs" class="flex px-4 gap-8">
            <button onclick="changeCategory('all')" data-cat="all" class="py-3 border-b-2 border-blue-600 text-blue-600 font-medium whitespace-nowrap">おすすめ</button>
            <button onclick="changeCategory('Action')" data-cat="Action" class="py-3 border-b-2 border-transparent text-gray-500 font-medium whitespace-nowrap">アクション</button>
            <button onclick="changeCategory('RPG')" data-cat="RPG" class="py-3 border-b-2 border-transparent text-gray-500 font-medium whitespace-nowrap">RPG</button>
            <button onclick="changeCategory('Puzzle')" data-cat="Puzzle" class="py-3 border-b-2 border-transparent text-gray-500 font-medium whitespace-nowrap">パズル</button>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 pb-24">
        <section>
            <div class="flex justify-between items-center mb-4">
                <h2 id="section-title" class="text-lg font-bold">ロード中...</h2>
            </div>
            <div id="game-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4">
                <!-- Skeleton Loader -->
                <div class="animate-pulse bg-gray-200 aspect-square rounded-2xl"></div>
                <div class="animate-pulse bg-gray-200 aspect-square rounded-2xl"></div>
                <div class="animate-pulse bg-gray-200 aspect-square rounded-2xl"></div>
            </div>
        </section>
    </main>

    <!-- Details Modal -->
    <div id="modal" class="fixed inset-0 bg-black/50 z-[100] hidden items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white w-full max-w-lg rounded-t-2xl sm:rounded-2xl overflow-hidden shadow-2xl animate-in slide-in-from-bottom duration-300">
            <div class="p-6">
                <div class="flex gap-4 mb-6">
                    <div id="modal-icon" class="w-20 h-20 rounded-2xl flex-shrink-0 flex items-center justify-center text-4xl"></div>
                    <div>
                        <h3 id="modal-title" class="text-2xl font-bold"></h3>
                        <p id="modal-publisher" class="text-green-700 font-medium text-sm"></p>
                    </div>
                </div>
                <div class="border-y border-gray-100 py-3 mb-6 flex justify-around text-center">
                    <div>
                        <div id="modal-rating" class="text-sm font-bold"></div>
                        <div class="text-[10px] text-gray-500">評価</div>
                    </div>
                    <div class="border-l border-gray-100 pl-4">
                        <div id="modal-category" class="text-sm font-bold"></div>
                        <div class="text-[10px] text-gray-500">カテゴリ</div>
                    </div>
                </div>
                <a id="modal-link" href="#" target="_blank" class="block w-full bg-green-700 text-white text-center py-2.5 rounded-full font-medium">
                    開く
                </a>
                <div class="mt-8">
                    <h4 class="font-bold mb-2">説明</h4>
                    <p id="modal-desc" class="text-gray-600 text-sm leading-relaxed"></p>
                </div>
            </div>
            <div class="bg-gray-50 p-4 text-center">
                <button onclick="closeModal()" class="text-gray-600 font-medium text-sm">閉じる</button>
            </div>
        </div>
    </div>

    <script>
        let allGames = [];
        let currentFilter = 'all';

        // GitHub Pagesの相対パスを考慮したパス解決
        const getBasePath = () => {
            const path = window.location.pathname;
            return path.substring(0, path.lastIndexOf('/') + 1);
        };

        async function loadAllData() {
            const base = getBasePath();
            try {
                // 明示的に相対パスを指定
                const listRes = await fetch(`${base}list.json`);
                if (!listRes.ok) throw new Error('List not found');
                const list = await listRes.json();
                
                const fetchPromises = list.games.map(id => 
                    fetch(`${base}data/${id}.json`).then(res => {
                        if (!res.ok) throw new Error(`Game data ${id} not found`);
                        return res.json();
                    })
                );
                
                allGames = await Promise.all(fetchPromises);
                renderGames();
            } catch (err) {
                console.error("Failed to load data:", err);
                document.getElementById('section-title').innerText = "データの読み込みに失敗しました。";
            }
        }

        function renderGames() {
            const container = document.getElementById('game-container');
            const sectionTitle = document.getElementById('section-title');
            container.innerHTML = '';
            
            const filtered = currentFilter === 'all' 
                ? allGames 
                : allGames.filter(g => g.category === currentFilter);

            sectionTitle.innerText = currentFilter === 'all' ? 'おすすめのゲーム' : `${currentFilter}のゲーム`;

            if (filtered.length === 0) {
                container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-10">該当するアイテムがありません</p>';
                return;
            }

            filtered.forEach(game => {
                const card = document.createElement('div');
                card.className = 'cursor-pointer group';
                card.onclick = () => openModal(game);
                card.innerHTML = `
                    <div class="aspect-square ${game.bgColor || 'bg-gray-100'} rounded-2xl flex items-center justify-center text-3xl shadow-sm mb-2 group-hover:scale-95 transition-transform duration-200">
                        ${game.icon}
                    </div>
                    <div class="px-1">
                        <div class="text-[11px] font-medium leading-tight line-clamp-2 mb-0.5">${game.title}</div>
                        <div class="text-[10px] text-gray-500">${game.rating} <i class="fa-solid fa-star text-[8px]"></i></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function changeCategory(cat) {
            currentFilter = cat;
            const buttons = document.querySelectorAll('#category-tabs button');
            buttons.forEach(btn => {
                if (btn.getAttribute('data-cat') === cat) {
                    btn.classList.add('border-blue-600', 'text-blue-600');
                    btn.classList.remove('border-transparent', 'text-gray-500');
                } else {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                }
            });
            renderGames();
        }

        function openModal(game) {
            document.getElementById('modal-title').innerText = game.title;
            document.getElementById('modal-publisher').innerText = game.publisher;
            document.getElementById('modal-desc').innerText = game.description;
            document.getElementById('modal-link').href = game.url;
            document.getElementById('modal-rating').innerHTML = `${game.rating} <i class="fa-solid fa-star text-[10px]"></i>`;
            document.getElementById('modal-category').innerText = game.category;
            
            const iconDiv = document.getElementById('modal-icon');
            iconDiv.className = `w-20 h-20 rounded-2xl ${game.bgColor || 'bg-gray-100'} flex-shrink-0 flex items-center justify-center text-4xl`;
            iconDiv.innerText = game.icon;

            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        window.onload = loadAllData;
    </script>
</body>
</html>